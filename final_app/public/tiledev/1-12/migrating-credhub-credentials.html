<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Migrating Existing Credentials to CredHub |
    
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
<script type="text/javascript">
  if (window.location.host === 'docs.pivotal.io') {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '']);
    _gaq.push(['_setDomainName', '']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  }
</script>

<script type="text/javascript">
  var blackList = ['acceptance'];

  blackList.forEach(function(blackListedEnv) {
    if (document.URL.indexOf(blackListedEnv) > -1 && blackListedEnv != "") {
      $('head').append('<meta name="hashtag" content="PivotalMoment">');
    }
  });
</script>

<!-- CrazyEgg Tracking Script -->
  <script type="text/javascript">
  setTimeout(function(){var a=document.createElement("script");
  var b=document.getElementsByTagName("script")[0];
  a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0055/2990.js?"+Math.floor(new Date().getTime()/3600000);
  a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>

<!-- Munchkin Marketo Script -->
<script type="text/javascript">
  (function() {
    var didInit = false;

    function initMunchkin() {
      if (didInit === false) {
        didInit = true;
        Munchkin.init('625-IUJ-009');
      }
    }

    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
    s.onreadystatechange = function() {
      if (this.readyState == 'complete' || this.readyState == 'loaded') {
        initMunchkin();
      }
    };
    s.onload = initMunchkin;
    document.getElementsByTagName('head')[0].appendChild(s);
  })();
</script>

</head>

<body class="tiledev tiledev_1-12 tiledev_1-12_migrating-credhub-credentials has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "";
    </script>

       
    <header class="header header-layout">
      <h1 class="logo">
        <a href="/">Default Book Title</a>
      </h1>
      
      <div class="header-links js-bar-links">
        <div class="btn-menu" data-behavior="MenuMobile"></div>
        
        <div class="header-item">
          
        </div>
        <!--Default search-->
<!--If book needs something different, add a book-search partial to the book's layouts folder-->
<div class="header-item searchbar js-searchbar">
  <a class="search-icon" data-behavior="Search"></a>
  <div class="search-input">
    <div class="search-input-inner" id="docs-search">
        <form method="get" action="/search">
          <input name="q" placeholder="search" class="search-box" />
        </form>
    </div>
  </div>
</div>

      </div>
    </header>



    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    <ul>

      <li>
        <a href="index.html">PCF Tile Developers Guide</a>
      </li>

      <li class="has_submenu">
        <a href="tile-basics.html">Tile Basics</a>
        <ul>
          <li>
            <a href="cf-concepts.html">How PCF and PCF Services Work</a>
          </li>
          <li>
            <a href="tile-structure.html">How Tiles Work</a>
          </li>
        </ul>
      </li>

      <li class="has_submenu">
        <a href="workflow.html">Tile Development Workflow</a>
        <ul>
          <li>
            <a href="overview.html">Service Integration Overview</a>
          </li>
          <li>
            <a href="stages.html">Levels of Integration</a>
          </li>
          <li>
            <a href="development.html">Development Steps at Each Level</a>
          </li>
        </ul>
      </li>

      <li class="has_submenu">
        <a href="environments.html">Development Environments</a>
        <ul>
          <li>
            <a href="environments.html#pcfdev">PCF Dev and BOSH Lite</a>
          </li>
          <li>
            <a href="environments.html#pws">PWS or Other Supported CF Infrastructure</a>
          </li>
          <li>
            <a href="environments.html#pcf">PCF with Ops Manager</a>
          </li>
        </ul>
      </li>

      <li class="has_submenu">
        <a href="tools.html">Development Tools</a>
        <ul>
          <li>
            <a href="tile-generator.html">Tile Generator</a>
          </li>
          <li>
            <a href="pcf-command.html">pcf Command Line Utility</a>
          </li>
          <li>
            <a href="concourse.html">Concourse CI</a>
          </li>
          <li>
            <a href="sdk.html">Services SDK</a>
          </li>
        </ul>
      </li>

      <li class="has_submenu expanded">
        <a href="roadmap.html">Service Development Roadmap</a>
        <ul>
          <li>
            <a href="roadmap.html#user-provided">Level 1: User-Provided Service</a>
          </li>
          <li class="has_submenu">
            <a href="brokered.html">Level 2: Brokered Service</a>
            <ul>
              <li>
                <a href="service-brokers.html">Service Broker</a>
              </li>
            </ul>
           </li> 
          <li class="has_submenu">
            <a href="managed.html">Level 3: Managed Service</a>
            <ul>
              <li>
                <a href="bosh-release.html">BOSH Releases</a>
              </li>
              <li>
                <a href="tile-errands.html">Errands</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="on-demand.html">Level 4: On-Demand Service</a>
          </li>
        </ul>
      </li>

      <li class="has_submenu">
        <a href="other-integrations.html">Other Integrations</a>
        <ul>
          <li>
            <a href="https://github.com/cloudfoundry/docs-bbr/blob/master/bbr-devguide.html.md.erb">BOSH Backup and Restore</a>
          </li>
          <li>
            <a href="buildpacks.html">Buildpacks</a>
          </li>
          <li class="has_submenu">
            <a href="credhub.html">CredHub</a>
            <ul>
              <li>
                <a href="create-credhub-vars.html">Creating New Variables in CredHub</a>
              </li>
              <li>
                <a href="migrating-credhub-credentials.html">Migrating Existing Credentials to CredHub</a>
              </li>
              <li>
                <a href="get-credhub-vars.html">Fetching Variable Names and Values</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="embedded-agents.html">Embedded Agents</a>
          </li>
          <li>
            <a href="nozzle.html">Logs, Metrics, and Nozzles</a>
          </li>
        </ul>
      </li>

      <li>
        <a href="tile-documentation.html">Documentation</a>
      </li>

      <li class="has_submenu">
        <a href="publish.html">Publish and Update</a>
        <ul>
          <li>
            <a href="tile-upgrades.html">Tile Upgrades</a>
          </li>
          <li>
            <a href="releases.html">Partner Software Product Release Cycle</a>
          </li>
        </ul>
      </li>


      <li class="has_submenu">
        <a href="reference.html">Reference</a>
        <ul>
          <li>
            <a href="product-template-reference.html">Product Template Reference</a>
          </li>
          <li>
            <a href="property-reference.html">Property Reference</a>
          </li>
        </ul>
      </li>

      <li class="has_submenu">
        <a href="release-notes.html">Partners Release Notices</a>
        <ul>
          <li>
            <a href="release-notes-1-12.html">PCF v1.12 Partners Release Notice</a>
          </li>
          <li>
            <a href="release-notes-1-11.html">PCF v1.11 Partners Release Notice</a>
          </li>
          <li>
            <a href="release-notes-1-10.html">PCF v1.10 Partners Release Notice</a>
          </li>
          <li>
            <a href="release-notes-1-9.html">PCF v1.9 Partners Release Notice</a>
          </li>
          <li>
            <a href="release-notes-1-8.html">PCF v1.8 Partners Release Notice</a>
          </li>
          <li>
            <a href="release-notes-1-7.html">PCF v1.7 Partners Release Notice</a>
          </li>
        </ul>
      </li>

      <li>
        <a href="contacts.html">Contact Us</a>
      </li>

    </ul>
  </div>
</div><!--end of sub-nav-->

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container" >
    Migrating Existing Credentials to CredHub
  </h1>

          <div id="js-quick-links" >
            <div class="quick-links"><ul>
<li><a href="#cred-types">CredHub Credential Types</a></li>
<li><a href="#javascript">Use the JavaScript Migration Process</a></li>
</ul></div>
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <p>This topic explains how to migrate non-configurable secrets from Ops Manager into CredHub.</p>

<h2><a id="cred-types"></a>CredHub Credential Types</h2>

<p>CredHub uses BOSH credential types, which may have different names from Ops Manager credential types.
The following table lists the Ops Manager credential types you can migrate to CredHub and the corresponding CredHub credential types.</p>

<table>
  <tr>
    <th>Ops Manager Credential Type</th>
    <th>CredHub Credential Type</th>
    <th>Supported Ops Manager Version</th>
  </tr>
  <tr>
    <td><code>secret</code></td>
    <td><code>password</code></td>
    <td>1.11.1</td>
  </tr>
  <tr>
    <td><code>simple_credential</code></td>
    <td><code>user</code></td>
    <td>1.12 Alpha 1</td>
  </tr>
  <tr>
    <td><code>salted_credential</code></td>
    <td><code>user</code></td>
    <td>1.12 Beta 1</td>
  </tr>
  <tr>
    <td><code>rsa_pkey_credential</code></td>
    <td><code>rsa</code></td>
    <td>1.12 Alpha 1</td>
  </tr>
</table>

<p class="note"><strong>Note</strong>: CredHub does not retain the salt when migrating <code>salted_credentials</code>.</p>

<p>See <a href="/tiledev/1-12/property-reference.html#secret">Property Reference</a> for more information about credential types.</p>

<h2><a id="javascript"></a> Use the JavaScript Migration Process</h2>

<p>Tile authors can write a JavaScript migration to move their existing non-configurable secrets into CredHub. After a successful migration, Ops Manager deletes credentials from installation.yml.</p>

<ol>
<li><p>Use the following example to write the JavaScript migration.
Save the JavaScript file to the PRODUCT/migrations/v1 directory of your .pivotal tile,
following the naming conventions discussed in the <a href="/tiledev/1-12/tile-upgrades.html">Update Values or Property Names Using JavaScript</a> topic.</p>
<pre class="highlight javascript"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">migrate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">input</span><span class="p">.</span><span class="nx">variable_migrations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
    <span class="na">from</span><span class="p">:</span> <span class="nx">input</span><span class="p">.</span><span class="nx">properties</span><span class="p">[</span><span class="s1">'.PROPERTY-REFERENCE.EXAMPLE-SECRET'</span><span class="p">],</span>
    <span class="na">to_variable</span><span class="p">:</span> <span class="s1">'SECRET-VARIABLE'</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">input</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>

<p>In the code block above, replace the example text as follows:</p>

<ul>
<li><code>PROPERTY-REFERENCE</code>: Replace with the property reference that corresponds to the metadata file, such as <code>properties</code>. See <a href="/tiledev/1-12/tile-upgrades.html#import">Tile Upgrades</a> for more information about migrating properties.</li>
<li><code>EXAMPLE-SECRET</code>: Replace with the name of the key.</li>
<li><code>SECRET-VARIABLE</code>: Choose a variable name for the migrated secret.</li>
</ul></li>
<li><p>Remove the property blueprint for the secret and replace it with a CredHub variable.</p>

<ul>
<li><p>In your metadata, remove the block that includes the credential. For example, remove
the block that includes <code>-name: EXAMPLE-SECRET</code> and <code>type: secret</code>:</p>
<pre class="highlight plaintext"><code>property_blueprints:
  - name: EXAMPLE-SECRET
    type: secret
  - name: generated_uuid
    type: uuid
  - name: configured_secret
    type: secret
    configurable: true
    optional: true
  - name: configured_simple_credentials
    type: simple_credentials
    configurable: true
    optional: true
</code></pre></li>
<li><p>In handcraft.yml, add a variables section and include the variable name and type:</p>
<pre class="highlight plaintext"><code>variables:
  - name: SECRET-VARIABLE
    type: password
</code></pre>

<p class="note"><strong>Note</strong>: While the property blueprint refers to the above type as <code>secret</code>, BOSH refers to the type as <code>password</code>. See the
<a href="#cred-types">CredHub Credential Types</a> table at the beginning of this topic for more information about credential types.</p></li>
</ul></li>
<li><p>In your manifest snippet, replace the existing secret value with the new triple-parenthesis syntax.</p>

<ul>
<li><p>Remove the existing secret from the manifest snippet:</p>
<pre class="highlight plaintext"><code>secret: (( .PROPERTY-REFERENCE.SECRET-VARIABLE.SECRET-VALUE ))
</code></pre></li>
<li><p>Add the new CredHub variable to the manifest snippet:</p>
<pre class="highlight plaintext"><code>secret: ((( SECRET-VARIABLE )))
</code></pre></li>
</ul></li>
<li><p>Run a <a href="/tiledev/1-12/development.html#test-errands">test deploy</a> of your tile.</p></li>
<li><p>Use an API endpoint to confirm that the credential is stored in the variable. For more information about the endpoint, see <a href="/tiledev/1-12/get-credhub-vars.html">Fetching Variable Names and Values</a>. </p></li>
</ol>

        <div><a id='repo-link' href='http://github.com/pivotal-cf/docs-tiledev/tree/1.12/migrating-credhub-credentials.html.md.erb'>View the source for this page in GitHub</a></div>

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
  <a href='https://pivotal.io/privacy-policy'>Privacy Policy</a> | 
  <a href='https://pivotal.io/terms-of-use'>Terms of Use</a><br/>
  <a href='/'>Pivotal Documentation</a>
  &copy; 2017 <a href='https://pivotal.io'>Pivotal Software</a>, Inc. All Rights Reserved.
</div>
<div class="support">
  Need help? <a href="" target="_blank">Visit Support</a>
</div>

  </footer>
</div><!--end of container-->

</body>
</html>
